# Обмен сообщениями (RabbitMQ)

## 1. Терминология

-   **`kind`**: Тип взаимодействия. Может быть `rpc` (запрос-ответ) или `event` (публикация-подписка).
-   **`entity`**: Тип сущности в RabbitMQ. Может быть `exchange` (обменник) или `queue` (очередь).

## 2. Нейминг

Все сущности в RabbitMQ именуются по строгому шаблону для обеспечения консистентности.

-   **Формат**: `core.<service>.<kind>.<name>.v1`
-   **Пример**: `core.auth.rpc.issue_token.v1`

## 3. RPC-контракт

Все RPC-вызовы следуют единому формату ответа, определённому в `libs/domain/dto/rpc.py`.

### Структура `RpcResponse`

```json
{
  "success": true,
  "data": {
    "token": "...",
    "expires_in": 3600,
    "account_id": 123
  },
  "error_code": null,
  "message": null,
  "correlation_id": "req_a1b2c3d4"
}
success: bool: true, если операция успешна, иначе false.

data: Any: Полезная нагрузка при успехе.

error_code: str: Код ошибки при неуспехе.

message: str: Человекочитаемое описание ошибки.

correlation_id: str: Сквозной ID запроса для трассировки.


---

### C) Обновлённый `docs/ERROR_MODEL.md`

```markdown
# Модель ошибок и маппинг на HTTP

## 1. Коды ошибок

Все ошибки в системе, как внутренние, так и возвращаемые клиенту, идентифицируются уникальным строковым кодом. Эти коды определены в `libs/app/errors.py` в Enum `ErrorCode`.

Формат: `домен.описание_ошибки` (например, `auth.invalid_credentials`).

*(...таблица с кодами без изменений...)*