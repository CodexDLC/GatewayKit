# Архитектура проекта

## 1. Основные принципы

Проект построен на принципах микросервисной архитектуры с асинхронным обменом сообщениями через брокер RabbitMQ.

* **"Тонкие" приложения (`apps`) / "Толстые" библиотеки (`libs`)**: Вся основная бизнес-логика, доменные модели (DTO, ORM), инфраструктурный код и утилиты находятся в `libs`. Приложения в `apps` являются тонкими слоями, которые отвечают только за запуск и конфигурацию сервиса.
* **DI-контейнер**: Зависимости для каждого сервиса (подключения к БД, RabbitMQ) управляются через **специализированные DI-контейнеры** в `libs/containers/`. Они инициализируются при старте каждого сервиса.

## 2. Схема взаимодействия сервисов

                               +------------------+
                             / |     RabbitMQ     |
      (RPC-запросы/События) /  | (Брокер сообщений) |
                           /   +------------------+
+-----------+      +-------------------+      ^            +--------------------+
|  Клиенты  |----->|      Gateway      |---- /             |      Auth SVC      |
| (WS/HTTP) |      | (REST API / WS)   |                  | (RPC-сервис, JWT)  |
+-----------+      +-------------------+                  +--------------------+
                                                                     |
                                                                     v
                                                          +--------------------+
                                                          |     PostgreSQL     |
                                                          | (Схема 'auth')     |
                                                          +--------------------+

1.  **Gateway**: Единственная точка входа для клиентов. Отвечает за:
    * Прием HTTP и WebSocket запросов.
    * **Проксирование** запросов аутентификации в `Auth SVC` через RPC.
    * **Авторизацию** всех входящих запросов (проверка JWT).
    * Трансляцию событий из RabbitMQ клиентам по WebSocket.
2.  **RabbitMQ**: Центральный брокер для асинхронного взаимодействия.
3.  **Auth SVC**: Сервис аутентификации. Отвечает за:
    * Регистрацию, вход, выход, обновление токенов.
    * Работу с базой данных (таблицы `accounts`, `credentials`, `refresh_tokens`).
    * Выпуск и валидацию JWT.
4.  **PostgreSQL**: Основное хранилище данных для `auth_svc`.