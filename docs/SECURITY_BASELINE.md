# Базовые стандарты безопасности

Этот документ описывает минимальные требования безопасности для разных сред.

## 1. Среда разработки (`development`)

-   **Секреты**: Допускается хранение секретов (пароли, JWT-ключи) в локальном `.env` файле.
-   **Учётные записи**:
    -   **RabbitMQ**: По умолчанию используется `admin`-пользователь, заданный в `docker-compose.yml`.
    -   **PostgreSQL**: Используется пользователь, заданный в `docker-compose.yml`.
-   **CORS**: Политика `AllowedOrigins` может быть установлена в `*`.
-   **Rate Limiting / Защита от брутфорса**: Отключены.

## 2. Production-среда (`production`)

Перед выкаткой в прод **обязательно** выполнить следующий чек-лист.

### Чек-лист готовности к Production

-   [ ] **Управление секретами**:
    -   [ ] Все секреты (пароли от БД, RabbitMQ, JWT-ключ) вынесены из кода и переменных окружения в безопасное хранилище (например, HashiCorp Vault, AWS Secrets Manager, Kubernetes Secrets).
    -   [ ] JWT-секрет является длинной, криптостойкой случайной строкой.

-   [ ] **Доступ к RabbitMQ**:
    -   [ ] Создан отдельный `vhost` для production.
    -   [ ] Для каждого сервиса создан свой пользователь с минимально необходимыми правами (например, `auth_svc` может только читать/писать в свои RPC-очереди).
    -   [ ] Пользователь `guest` отключён.

-   [ ] **Доступ к PostgreSQL**:
    -   [ ] Для каждого сервиса создан свой пользователь БД с правами только на свою схему (`GRANT USAGE ON SCHEMA ...`, `GRANT SELECT, INSERT, ... ON ALL TABLES IN SCHEMA ...`).

-   [ ] **Сетевая безопасность**:
    -   [ ] **Gateway**:
        -   [ ] Настроен строгий CORS (`ALLOWED_ORIGINS` указывает только на домены фронтенда).
        -   [ ] Включён и настроен Rate Limiter для защиты от DoS-атак.
        -   [ ] Включена защита от брутфорса для эндпоинта `/auth/token`.
    -   [ ] Между сервисами настроены сетевые политики (Network Policies), разрешающие трафик только к нужным портам.

-   [ ] **Логирование и мониторинг**:
    -   [ ] Настроен сбор и анализ логов.
    -   [ ] Настроены алерты на критические ошибки (`level: ERROR` или `CRITICAL`).